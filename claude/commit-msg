#!/bin/bash
# Global commit-msg hook to prevent Claude Code footer violations
# Automatically strips forbidden content from commit messages

# Path to the commit message file
COMMIT_MSG_FILE="$1"

# Strip Claude Code footers
sed -i '/ğŸ¤– Generated with \[Claude Code\]/d' "$COMMIT_MSG_FILE"
sed -i '/Co-Authored-By: Claude/d' "$COMMIT_MSG_FILE"

# Remove excessive blank lines (more than 2 consecutive)
sed -i '/^$/N;/^\n$/d' "$COMMIT_MSG_FILE"

# Remove trailing empty lines
sed -i -e :a -e '/^\s*$/N;$ba' -e '$d' "$COMMIT_MSG_FILE"

# Log the cleaning action (optional - remove if you don't want notifications)
if grep -q "Generated with.*Claude Code\|Co-Authored-By: Claude" "$COMMIT_MSG_FILE" 2>/dev/null; then
    echo "ğŸ§¹ Stripped Claude Code footers from commit message"
fi