#!/bin/bash
# Claude Code commit message protection hook
# Automatically strips forbidden content from commit messages

# Exit immediately if no file provided
if [ -z "$1" ] || [ ! -f "$1" ]; then
    exit 0
fi

COMMIT_MSG_FILE="$1"

# Create a temporary file for safe editing
TEMP_FILE=$(mktemp)
cp "$COMMIT_MSG_FILE" "$TEMP_FILE"

# Remove Claude Code footers using grep -v (safer than sed -i)
grep -v "ðŸ¤– Generated with \[Claude Code\]" "$TEMP_FILE" | \
grep -v "Co-Authored-By: Claude" > "$COMMIT_MSG_FILE"

# Clean up
rm "$TEMP_FILE"

exit 0